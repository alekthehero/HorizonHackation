<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StoryRx - Personalized Health Education</title>
  <!-- For production, do not use cdn.tailwindcss.com -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tell Tailwind to use the "class" strategy for dark mode.
    tailwind.config = { darkMode: 'class' }
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    @keyframes gradientWave {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .gradient-bg {
      background: linear-gradient(135deg, #6366f1, #3b82f6, #10b981);
      background-size: 400% 400%;
      animation: gradientWave 15s ease infinite;
    }
    .medical-illustration {
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f0f4ff" /></svg>');
      background-size: cover;
    }

    /* Game container styles */
    .game-container {
      max-width: 600px;
      margin: 4rem auto 0 auto;
      background: #ffffff;
      border-radius: 1rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 2rem;
      text-align: center;
    }
    .clue-stack {
      margin: 1rem 0;
    }
    .clue {
      cursor: pointer;
      background-color: #e2e8f0;
      margin: 0.25rem 0;
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: background-color 0.2s;
    }
    .clue:hover {
      background-color: #cbd5e1;
    }
    .revealed {
      background-color: #60a5fa;
      color: #fff;
    }
    .guess-area {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }
    .guess-area input {
      padding: 0.5rem;
      border: 1px solid #cbd5e1;
      border-radius: 0.375rem;
      outline: none;
    }
    .guess-area button {
      padding: 0.5rem 1rem;
      background-color: #3b82f6;
      color: #fff;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .guess-area button:hover {
      background-color: #2563eb;
    }
    .feedback {
      margin-top: 1rem;
      font-size: 1.25rem;
      font-weight: 700;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
    }
    .feedback i {
      font-size: 1.5rem;
    }
    .feedback.correct {
      color: #10b981;
    }
    .feedback.incorrect {
      color: #ef4444;
    }
    .end-message {
      margin-top: 1.5rem;
      font-size: 1.25rem;
      font-weight: 600;
    }
    .restart-btn {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background-color: #3b82f6;
      color: #fff;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .restart-btn:hover {
      background-color: #2563eb;
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">

  <!-- Single Navigation -->
  <nav class="bg-white/80 dark:bg-gray-800/90 backdrop-blur-md shadow-lg fixed w-full z-50 border-b border-gray-100/20">
    <div class="max-w-7xl mx-auto px-4">
      <div class="flex justify-between items-center h-16">
        <!-- Clickable Logo => returns to landing content -->
        <a href="#" id="logo-link" class="flex items-center space-x-3">
          <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-heartbeat text-white text-lg"></i>
          </div>
          <span class="text-xl font-bold bg-gradient-to-r from-blue-600 to-green-600 bg-clip-text text-transparent">
            StoryRx
          </span>
        </a>

        <div class="hidden md:flex space-x-8 items-center">
          <a href="#features" data-i18n="nav.features"
             class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 transition-colors font-medium">
            Features
          </a>
          <a href="#symptom-checker" data-i18n="nav.symptomChecker"
             class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 transition-colors font-medium">
            Symptom Checker
          </a>
          <!-- Knowledge Hub => opens game view -->
          <a href="#" id="knowledge-hub-link" data-i18n="nav.knowledgeHub"
             class="text-gray-600 hover:text-blue-600 dark:text-gray-300 dark:hover:text-blue-400 transition-colors font-medium">
            Knowledge Hub
          </a>
          <!-- Dark mode toggle -->
          <button id="dark-mode-toggle"
                  class="p-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                  aria-label="Toggle dark mode">
            <i class="fas fa-moon text-gray-600 dark:text-gray-300"></i>
          </button>
          <!-- Language selector -->
          <select id="language-select" class="bg-white/80 rounded-md px-2 py-1 text-gray-900">
            <option value="en">English</option>
            <option value="es">Espa√±ol</option>
          </select>
        </div>
      </div>
    </div>
  </nav>

  <!-- Landing Content (Home Page) -->
  <div id="landing-content" class="pt-20">
    <!-- Hero Section with Personalized Intake Form -->
    <section class="gradient-bg pt-32 pb-24 text-white relative overflow-hidden">
      <div class="max-w-7xl mx-auto px-4 text-center relative z-10">
        <h1 data-i18n="hero.title" class="text-5xl md:text-6xl font-bold mb-6 leading-tight">
          Your Health,<br class="hidden md:block">
          <span class="bg-white/10 px-4 rounded-lg">Your Story</span>
        </h1>
        <p data-i18n="hero.subtitle" class="text-xl mb-12 opacity-90 max-w-2xl mx-auto leading-relaxed">
          AI-powered health insights tailored to your unique needs. Get personalized medical information that you can understand.
        </p>

        <!-- Personalized Intake Form -->
        <div class="max-w-xl mx-auto bg-white/20 backdrop-blur-lg rounded-xl p-6 shadow-xl text-left">
          <form id="personal-info-form" class="space-y-4">
            <!-- Name -->
            <div>
              <label for="user-name" data-i18n="form.name" class="block text-sm font-medium mb-1">Name</label>
              <input type="text" id="user-name" name="user-name"
                     class="w-full bg-white/80 rounded-md py-2 px-3 focus:outline-none text-gray-900"
                     placeholder="Enter your name"
                     required>
            </div>
            <!-- Gender -->
            <div>
              <label data-i18n="form.gender" class="block text-sm font-medium mb-1">Gender</label>
              <div class="flex space-x-4">
                <label class="cursor-pointer flex items-center space-x-1">
                  <input type="radio" name="gender" value="Male" class="sr-only peer">
                  <span class="px-3 py-1 rounded-full border border-gray-300 peer-checked:bg-blue-600 peer-checked:text-white">Male</span>
                </label>
                <label class="cursor-pointer flex items-center space-x-1">
                  <input type="radio" name="gender" value="Female" class="sr-only peer">
                  <span class="px-3 py-1 rounded-full border border-gray-300 peer-checked:bg-blue-600 peer-checked:text-white">Female</span>
                </label>
                <label class="cursor-pointer flex items-center space-x-1">
                  <input type="radio" name="gender" value="Other" class="sr-only peer">
                  <span class="px-3 py-1 rounded-full border border-gray-300 peer-checked:bg-blue-600 peer-checked:text-white">Other</span>
                </label>
              </div>
            </div>
            <!-- Education Level -->
            <div>
              <label for="education-level" data-i18n="form.educationLevel" class="block text-sm font-medium mb-1">Education Level</label>
              <select id="education-level" name="education-level"
                      class="w-full bg-white/80 rounded-md py-2 px-3 focus:outline-none text-gray-900"
                      required>
                <option value="">Select your education level</option>
                <option value="High School">High School</option>
                <option value="Undergraduate">Undergraduate</option>
                <option value="Graduate">Graduate</option>
                <option value="Postgraduate">Postgraduate</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <!-- Age Slider -->
            <div>
              <label for="user-age" class="block text-sm font-medium mb-1">
                <span data-i18n="form.age">Age:</span>
                <span id="age-value" class="font-semibold">30</span>
              </label>
              <input type="range" id="user-age" name="user-age" min="0" max="100" value="30"
                     class="w-full"
                     oninput="document.getElementById('age-value').textContent = this.value">
            </div>
            <!-- Skin Color Options -->
            <div>
              <label data-i18n="form.skinColor" class="block text-sm font-medium mb-1">Skin Color</label>
              <div class="flex space-x-4 items-center">
                <label class="cursor-pointer flex flex-col items-center">
                  <input type="radio" name="skinColor" value="Light" class="sr-only peer">
                  <div class="w-8 h-8 bg-yellow-100 border-2 border-white peer-checked:border-blue-500 rounded-full"></div>
                  <span class="mt-1 text-xs">Light</span>
                </label>
                <label class="cursor-pointer flex flex-col items-center">
                  <input type="radio" name="skinColor" value="Medium" class="sr-only peer">
                  <div class="w-8 h-8 bg-yellow-300 border-2 border-white peer-checked:border-blue-500 rounded-full"></div>
                  <span class="mt-1 text-xs">Medium</span>
                </label>
                <label class="cursor-pointer flex flex-col items-center">
                  <input type="radio" name="skinColor" value="Tan" class="sr-only peer">
                  <div class="w-8 h-8 bg-yellow-500 border-2 border-white peer-checked:border-blue-500 rounded-full"></div>
                  <span class="mt-1 text-xs">Tan</span>
                </label>
                <label class="cursor-pointer flex flex-col items-center">
                  <input type="radio" name="skinColor" value="Dark" class="sr-only peer">
                  <div class="w-8 h-8 bg-yellow-700 border-2 border-white peer-checked:border-blue-500 rounded-full"></div>
                  <span class="mt-1 text-xs">Dark</span>
                </label>
              </div>
            </div>
            <!-- Zip Code -->
            <div>
              <label for="zip-code" data-i18n="form.zipCode" class="block text-sm font-medium mb-1">Zip Code</label>
              <input type="text" id="zip-code" name="zip-code"
                     class="w-full bg-white/80 rounded-md py-2 px-3 focus:outline-none text-gray-900"
                     placeholder="12345"
                     required>
            </div>
            <!-- Conditions -->
            <div>
                <label data-i18n="form.conditions" class="block text-sm font-medium mb-2">Select Your Conditions</label>
                <div class="flex flex-wrap gap-2">
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Diabetes" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Diabetes</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Hypertension" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Hypertension</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Asthma" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Asthma</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Heart Disease" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Heart Disease</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Cancer" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Cancer</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Obesity" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Obesity</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Arthritis" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Arthritis</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Depression" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Depression</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Anxiety" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Anxiety</span>
                  </label>
                  <label class="cursor-pointer relative">
                    <input type="checkbox" name="conditions" value="Allergies" class="sr-only peer">
                    <span class="bg-white/80 px-3 py-1 rounded-full transition text-gray-900 peer-hover:bg-white peer-checked:bg-blue-600 peer-checked:text-white">Allergies</span>
                  </label>
                </div>
              </div>
            <!-- Submit Button -->
            <div class="pt-4 text-center">
              <button type="submit" data-i18n="form.submit"
                      class="bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 transition">
                Submit
              </button>
            </div>
          </form>

          <!-- Loading Indicator (Hidden by default) -->
          <div id="loading-indicator" class="flex items-center justify-center mt-4 text-white hidden">
            <svg class="animate-spin h-5 w-5 mr-3" xmlns="http://www.w3.org/2000/svg"
                 fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="4"></circle>
              <path class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8v8H4z">
              </path>
            </svg>
            <span data-i18n="loading">Generating articles...</span>
          </div>

          <!-- Article Suggestions -->
          <div id="article-suggestions" class="max-w-xl mx-auto mt-8 hidden"></div>
        </div>

        <!-- Trust Badges -->
        <div class="mt-8 flex flex-wrap justify-center gap-6 opacity-90">
          <div class="flex items-center space-x-2">
            <i class="fas fa-shield-check"></i>
            <span data-i18n="trust.hipaa">HIPAA Compliant</span>
          </div>
          <div class="flex items-center space-x-2">
            <i class="fas fa-stethoscope"></i>
            <span data-i18n="trust.doctor">Doctor Reviewed</span>
          </div>
          <div class="flex items-center space-x-2">
            <i class="fas fa-clock-rotate-left"></i>
            <span data-i18n="trust.support">24/7 Support</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-20 bg-white dark:bg-gray-800">
      <div class="max-w-7xl mx-auto px-4">
        <div class="grid md:grid-cols-3 gap-8">
          <!-- Feature Card 1 -->
          <div class="bg-gray-50 dark:bg-gray-700 p-8 rounded-2xl transition hover:-translate-y-2">
            <div class="w-16 h-16 bg-blue-100 dark:bg-blue-900 rounded-xl flex items-center justify-center mb-6">
              <i class="fas fa-brain text-2xl text-blue-600 dark:text-blue-400"></i>
            </div>
            <h3 data-i18n="features.insightsTitle" class="text-xl font-bold mb-4 dark:text-white">
              AI-Powered Insights
            </h3>
            <p data-i18n="features.insightsDesc" class="text-gray-600 dark:text-gray-300">
              Advanced machine learning algorithms analyze your symptoms in context of medical literature and similar cases.
            </p>
          </div>
          <!-- Feature Card 2 -->
          <div class="bg-gray-50 dark:bg-gray-700 p-8 rounded-2xl transition hover:-translate-y-2">
            <div class="w-16 h-16 bg-green-100 dark:bg-green-900 rounded-xl flex items-center justify-center mb-6">
              <i class="fas fa-book-medical text-2xl text-green-600 dark:text-green-400"></i>
            </div>
            <h3 data-i18n="features.educationTitle" class="text-xl font-bold mb-4 dark:text-white">
              Personalized Education
            </h3>
            <p data-i18n="features.educationDesc" class="text-gray-600 dark:text-gray-300">
              Interactive learning paths adapt to your health profile and medical history.
            </p>
          </div>
          <!-- Feature Card 3 -->
          <div class="bg-gray-50 dark:bg-gray-700 p-8 rounded-2xl transition hover:-translate-y-2">
            <div class="w-16 h-16 bg-purple-100 dark:bg-purple-900 rounded-xl flex items-center justify-center mb-6">
              <i class="fas fa-users text-2xl text-purple-600 dark:text-purple-400"></i>
            </div>
            <h3 data-i18n="features.communityTitle" class="text-xl font-bold mb-4 dark:text-white">
              Medical Community
            </h3>
            <p data-i18n="features.communityDesc" class="text-gray-600 dark:text-gray-300">
              Connect with verified healthcare professionals and patient support groups.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Chatbot / Symptom Checker Section -->
    <section id="symptom-checker" class="py-20 bg-gray-50 dark:bg-gray-900">
      <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
          <div class="p-8 border-b border-gray-100 dark:border-gray-700">
            <div class="flex items-center gap-4">
              <div class="shrink-0">
                <div class="w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
                  <i class="fas fa-robot text-white text-xl"></i>
                </div>
              </div>
              <div>
                <h3 class="text-xl font-bold dark:text-white">
                  Symptom Analysis Assistant
                </h3>
                <p class="text-gray-600 dark:text-gray-300">
                  Real-time conversation with personalized medical AI
                </p>
              </div>
            </div>
          </div>
          <!-- Chat Container -->
          <div id="chat-container" class="h-96 overflow-y-auto p-6 space-y-4 medical-illustration">
            <!-- Initial message -->
            <div class="flex gap-4">
              <div class="max-w-md bg-white dark:bg-gray-700 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-600">
                <div class="flex items-center gap-3 mb-2">
                  <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                    <i class="fas fa-user-md text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <span class="text-sm font-medium dark:text-white">Dr. Assistant</span>
                </div>
                <p data-i18n="chatbot.welcome" class="text-gray-600 dark:text-gray-300">
                  Welcome! Based on your profile, I'm here to offer personalized insights. How are you feeling today?
                </p>
              </div>
            </div>
          </div>
          <!-- Input Area -->
          <div class="p-6 border-t border-gray-100 dark:border-gray-700">
            <div class="flex gap-4">
              <input type="text" id="chat-input"
                     class="w-full px-6 py-4 rounded-xl border focus:outline-none focus:ring-2
                            dark:bg-gray-700 dark:text-white"
                     placeholder="Type your response...">
              <button id="send-button"
                      class="px-8 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition flex items-center gap-2">
                <span data-i18n="chatbot.send">Send</span>
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Game Content (Initially Hidden) -->
  <div id="game-content" style="display: none; padding-top:5rem;">
    <div class="game-container">
      <h1 class="text-2xl font-bold mb-4">Health Points</h1>
      <p class="text-gray-700 mb-6">
        Reveal each clue and guess the health theme! You‚Äôll see a checkmark if correct, or an X if not.
      </p>
      <div id="Points-game"><!-- Game UI is rendered here --></div>
    </div>
  </div>

  <!-- Single Footer -->
  <footer class="bg-gray-800 text-white py-12">
    <div class="max-w-7xl mx-auto px-4">
      <div class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        <div>
          <h3 class="text-xl font-bold mb-4">About StoryRx</h3>
          <p class="text-gray-400">
            We deliver personalized health insights through engaging stories and AI-driven tools.
          </p>
        </div>
      </div>
      <div class="mt-8 text-center text-gray-500">
        &copy; 2025 StoryRx. All rights reserved.
      </div>
    </div>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      /* ------------------------- Translations & Language ------------------------- */
      const translations = {
        en: {
          'nav.features': 'Features',
          'nav.symptomChecker': 'Symptom Checker',
          'nav.knowledgeHub': 'Knowledge Hub',
          'hero.title': 'Your Health, <br class="hidden md:block"><span class="bg-white/10 px-4 rounded-lg">Your Story</span>',
          'hero.subtitle': 'AI-powered health insights tailored to your unique needs. Get personalized medical information that you can understand.',
          'form.name': 'Name',
          'form.gender': 'Gender',
          'form.educationLevel': 'Education Level',
          'form.age': 'Age:',
          'form.skinColor': 'Skin Color',
          'form.zipCode': 'Zip Code',
          'form.conditions': 'Select Your Conditions',
          'form.submit': 'Submit',
          'loading': 'Generating articles...',
          'articles.title': 'Recommended Articles',
          'trust.hipaa': 'HIPAA Compliant',
          'trust.doctor': 'Doctor Reviewed',
          'trust.support': '24/7 Support',
          'features.insightsTitle': 'AI-Powered Insights',
          'features.insightsDesc': 'Advanced machine learning algorithms analyze your symptoms in context of medical literature and similar cases.',
          'features.educationTitle': 'Personalized Education',
          'features.educationDesc': 'Interactive learning paths adapt to your health profile and medical history.',
          'features.communityTitle': 'Medical Community',
          'features.communityDesc': 'Connect with verified healthcare professionals and patient support groups.',
          'chatbot.welcome': "Welcome! Based on your profile, I'm here to offer personalized insights. How are you feeling today?",
          'chatbot.send': 'Send'
        },
        es: {
          'nav.features': 'Caracter√≠sticas',
          'nav.symptomChecker': 'Verificador de S√≠ntomas',
          'nav.knowledgeHub': 'Centro de Conocimiento',
          'hero.title': 'Tu Salud, <br class="hidden md:block"><span class="bg-white/10 px-4 rounded-lg">Tu Historia</span>',
          'hero.subtitle': 'Informaci√≥n m√©dica impulsada por IA adaptada a tus necesidades √∫nicas. Obt√©n informaci√≥n m√©dica personalizada que puedas entender.',
          'form.name': 'Nombre',
          'form.gender': 'G√©nero',
          'form.educationLevel': 'Nivel Educativo',
          'form.age': 'Edad:',
          'form.skinColor': 'Color de Piel',
          'form.zipCode': 'C√≥digo Postal',
          'form.conditions': 'Selecciona Tus Condiciones',
          'form.submit': 'Enviar',
          'loading': 'Generando art√≠culos...',
          'articles.title': 'Art√≠culos Recomendados',
          'trust.hipaa': 'Cumple HIPAA',
          'trust.doctor': 'Revisado por M√©dicos',
          'trust.support': 'Soporte 24/7',
          'features.insightsTitle': 'Informaci√≥n Impulsada por IA',
          'features.insightsDesc': 'Algoritmos avanzados de aprendizaje autom√°tico analizan tus s√≠ntomas en el contexto de la literatura m√©dica y casos similares.',
          'features.educationTitle': 'Educaci√≥n Personalizada',
          'features.educationDesc': 'Rutas interactivas de aprendizaje se adaptan a tu perfil de salud e historial m√©dico.',
          'features.communityTitle': 'Comunidad M√©dica',
          'features.communityDesc': 'Con√©ctate con profesionales de la salud verificados y grupos de apoyo para pacientes.',
          'chatbot.welcome': "¬°Bienvenido! Basado en tu perfil, estoy aqu√≠ para ofrecerte informaci√≥n personalizada. ¬øC√≥mo te sientes hoy?",
          'chatbot.send': 'Enviar'
        }
      };

      const languageSelect = document.getElementById('language-select');
      languageSelect.addEventListener('change', function() {
        const lang = this.value;
        document.querySelectorAll('[data-i18n]').forEach(elem => {
          const key = elem.getAttribute('data-i18n');
          if (translations[lang] && translations[lang][key]) {
            elem.innerHTML = translations[lang][key];
          }
        });
      });
      // Set default language to English
      languageSelect.value = 'en';
      languageSelect.dispatchEvent(new Event('change'));

      /* ------------------------- Dark Mode Toggle ------------------------- */
      const darkModeToggle = document.getElementById('dark-mode-toggle');
      if (localStorage.getItem('darkMode') === 'true') {
        document.documentElement.classList.add('dark');
        darkModeToggle.innerHTML = '<i class="fas fa-sun text-amber-400"></i>';
      }
      darkModeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        const isDark = document.documentElement.classList.contains('dark');
        localStorage.setItem('darkMode', isDark);
        darkModeToggle.innerHTML = isDark
          ? '<i class="fas fa-sun text-amber-400"></i>'
          : '<i class="fas fa-moon text-gray-600"></i>';
      });

      /* ------------------------- View Switching ------------------------- */
      const landingContent = document.getElementById('landing-content');
      const gameContent = document.getElementById('game-content');
      const knowledgeHubLink = document.getElementById('knowledge-hub-link');
      const logoLink = document.getElementById('logo-link');

      // Knowledge Hub => show game
      knowledgeHubLink.addEventListener('click', (e) => {
        e.preventDefault();
        landingContent.style.display = 'none';
        gameContent.style.display = 'block';
      });

      // Logo => go back to landing
      logoLink.addEventListener('click', (e) => {
        e.preventDefault();
        gameContent.style.display = 'none';
        landingContent.style.display = 'block';
      });

      /* ------------------------- Game Logic ------------------------- */
      const clues = [
        { text: "Helps maintain cardiovascular health", revealed: false },
        { text: "Can be done with minimal equipment", revealed: false },
        { text: "Common examples: jogging, brisk walking", revealed: false },
        { text: "Often recommended at least 150 minutes/week", revealed: false },
        { text: "Also known as 'cardio' workouts", revealed: false }
      ];
      const acceptableAnswers = [
        "aerobic exercise", "aerobic exercises", "cardio", "cardio exercise",
        "cardio exercises", "cardiovascular exercise", "cardiovascular exercises"
      ];
      let currentClueIndex = 0;
      let guessedCorrectly = false;

      function renderGame() {
        const gameEl = document.getElementById('Points-game');
        if (!gameEl) return; // If user hasn't switched to game yet
        if (guessedCorrectly || currentClueIndex >= clues.length) {
          gameEl.innerHTML = `
            ${clues.map(cl => `<div class="clue revealed">${cl.text}</div>`).join('')}
            <div class="end-message">
              ${
                guessedCorrectly
                  ? "Great job! You won 10 wellness points."
                  : "All clues revealed! The correct answer is 'aerobic exercise.'"
              }
            </div>
            <button class="restart-btn" onclick="restartGame()">Play Again</button>
          `;
          return;
        }
        let stackHtml = "";
        for (let i = 0; i <= currentClueIndex; i++) {
          stackHtml += `<div class="clue revealed">${clues[i].text}</div>`;
        }
        for (let i = currentClueIndex + 1; i < clues.length; i++) {
          stackHtml += `<div class="clue" onclick="revealClue(${i})">Tap to Reveal Clue</div>`;
        }
        const guessArea = `
          <div class="guess-area">
            <input type="text" id="guess-input" placeholder="Your guess..." />
            <button onclick="handleGuess()">Guess</button>
          </div>
          <div id="feedback" class="feedback"></div>
        `;
        gameEl.innerHTML = `<div class="clue-stack">${stackHtml}</div>${guessArea}`;
      }

      // We attach these to window so we can call them from HTML
      window.revealClue = function(index) {
        if (index === currentClueIndex + 1) {
          currentClueIndex++;
          clues[index].revealed = true;
          renderGame();
        }
      };

      window.handleGuess = function() {
        const guessInput = document.getElementById('guess-input');
        if (!guessInput) return;
        const guessVal = guessInput.value.trim().toLowerCase();
        const feedbackEl = document.getElementById('feedback');
        if (!guessVal) {
          feedbackEl.innerHTML = `Please enter a guess.`;
          return;
        }
        const isCorrect = acceptableAnswers.some(ans => ans === guessVal);
        if (isCorrect) {
          guessedCorrectly = true;
          feedbackEl.innerHTML = `
            <span class="correct flex items-center">
              <i class="fas fa-check-circle"></i> Correct!
            </span>
          `;
          setTimeout(() => { renderGame(); }, 1200);
        } else {
          feedbackEl.innerHTML = `
            <span class="incorrect flex items-center">
              <i class="fas fa-times-circle"></i> Incorrect!
            </span>
          `;
        }
      };

      window.restartGame = function() {
        currentClueIndex = 0;
        guessedCorrectly = false;
        for (let i = 0; i < clues.length; i++) {
          clues[i].revealed = false;
        }
        renderGame();
      };

      // Render the game if user navigates there
      // If user starts on game, or if they switch to game
      renderGame();

      /* ------------------------- Chatbot & Articles ------------------------- */
      const apiKey = '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';
      let patientInfoText = "";

      function cleanGPTResponse(text) {
        return text.replace(/^```json\s*/i, '').replace(/```$/i, '').trim();
      }

      async function generateArticleSuggestions({ name, age, gender, skinColor, zip, conditions }) {
        const prompt = `
You are a professional medical writer. Based on the following patient data, generate 3 highly personalized article suggestions that cater to the patient's medical needs and education level. Use all the provided information (name, age, gender, skinColor, zip code, conditions) to craft unique article titles and excerpts that feel personal‚Äîwithout explicitly mentioning the zip code.
Patient Data:
- Name: ${name}
- Age: ${age}
- Gender: ${gender}
- Skin Color: ${skinColor}
- Conditions: ${conditions.join(', ')}
          
Return only a valid JSON array (without markdown formatting) of objects in the following format:
[
  {
    "title": "Custom Article Title",
    "icon": "iconname",
    "content": "A brief, medically intelligent article excerpt tailored to the patient."
  },
  ...
]
        `;
        try {
          const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: 'gpt-3.5-turbo',
              messages: [
                { role: 'system', content: 'You are a professional medical writer.' },
                { role: 'user', content: prompt }
              ]
            })
          });
          if (!response.ok) {
            const errorData = await response.json();
            console.error('Article API error:', errorData);
            return [];
          }
          const data = await response.json();
          let assistantResponse = data.choices[0].message.content;
          assistantResponse = cleanGPTResponse(assistantResponse);
          let articles = [];
          try {
            articles = JSON.parse(assistantResponse);
          } catch (err) {
            console.warn('JSON parse error, using fallback articles.', err);
            articles = [
              {
                title: "Tailored Strategies for Urban Mental Health",
                icon: "sun",
                content: "Explore personalized approaches to managing depression and stress influenced by urban life."
              },
              {
                title: "Managing Asthma in Challenging Climates",
                icon: "wind",
                content: "Learn techniques to control asthma symptoms with tips tailored to your personal health profile."
              },
              {
                title: "Personalized Heart Health Advice for Your Lifestyle",
                icon: "heartbeat",
                content: "Discover insights into maintaining heart health that take into account your unique demographic and health factors."
              }
            ];
          }
          return articles;
        } catch (error) {
          console.error('Error fetching article suggestions:', error);
          return [];
        }
      }

      function displayArticles(articles) {
        const articleSection = document.getElementById('article-suggestions');
        articleSection.classList.remove('hidden');
        articleSection.innerHTML = `
          <h2 data-i18n="articles.title" class="text-2xl font-bold mb-4">Recommended Articles</h2>
          <div class="space-y-3">
            ${articles.map(article => `
              <a href="#" class="block bg-white/20 px-4 py-3 rounded-lg hover:bg-white/30 transition flex items-center gap-3">
                <i class="fas fa-${article.icon} text-xl"></i>
                <div>
                  <h3 class="font-bold">${article.title}</h3>
                  <p class="text-sm">${article.content}</p>
                </div>
              </a>
            `).join('')}
          </div>
        `;
      }

      const form = document.getElementById('personal-info-form');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('user-name').value.trim();
        const age = document.getElementById('user-age').value;
        const zip = document.getElementById('zip-code').value.trim();

        let gender = '';
        document.querySelectorAll('input[name="gender"]').forEach(radio => {
          if (radio.checked) gender = radio.value;
        });

        let skinColor = '';
        document.querySelectorAll('input[name="skinColor"]').forEach(radio => {
          if (radio.checked) skinColor = radio.value;
        });

        const conditions = [];
        document.querySelectorAll('input[name="conditions"]:checked').forEach(chk => {
          conditions.push(chk.value);
        });

        const education = document.getElementById('education-level').value.trim();
        patientInfoText = `Patient Profile: Name: ${name}, Age: ${age}, Gender: ${gender}, Skin Color: ${skinColor}, Education: ${education}, Conditions: ${conditions.join(', ')}`;

        document.getElementById('loading-indicator').classList.remove('hidden');
        const articles = await generateArticleSuggestions({ name, age, gender, skinColor, zip, conditions });
        document.getElementById('loading-indicator').classList.add('hidden');
        displayArticles(articles);
      });

      /* ------------------------- Chatbot Logic ------------------------- */
      async function getChatbotResponse(prompt) {
        const systemMessage = patientInfoText
          ? `You are a helpful medical assistant. Use the following patient information to tailor your responses: ${patientInfoText}`
          : 'You are a helpful medical assistant.';
        try {
          const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: 'gpt-3.5-turbo',
              messages: [
                { role: 'system', content: systemMessage },
                { role: 'user', content: prompt }
              ]
            })
          });
          if (!response.ok) {
            const errorData = await response.json();
            console.error('Chatbot API error:', errorData);
            return "Error: " + (errorData.error?.message || 'Unknown error occurred.');
          }
          const data = await response.json();
          return data.choices[0].message.content.trim();
        } catch (error) {
          console.error('Error fetching chatbot response:', error);
          return "I'm sorry, I couldn't retrieve an answer at the moment.";
        }
      }

      function appendMessage(sender, text) {
        const chatContainer = document.getElementById('chat-container');
        const messageElement = document.createElement('div');
        if (sender === 'assistant') {
          messageElement.className = "flex gap-4";
          messageElement.innerHTML = `
            <div class="max-w-md bg-white dark:bg-gray-700 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-600">
              <div class="flex items-center gap-3 mb-2">
                <div class="w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center">
                  <i class="fas fa-user-md text-blue-600 dark:text-blue-400"></i>
                </div>
                <span class="text-sm font-medium dark:text-white">Dr. Assistant</span>
              </div>
              <p class="text-gray-600 dark:text-gray-300">${text}</p>
            </div>
          `;
        } else if (sender === 'user') {
          messageElement.className = "flex gap-4 justify-end";
          messageElement.innerHTML = `
            <div class="max-w-md bg-blue-600 text-white p-4 rounded-xl shadow-sm">
              <p>${text}</p>
            </div>
          `;
        }
        chatContainer.appendChild(messageElement);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      const sendButton = document.getElementById('send-button');
      sendButton.addEventListener('click', async () => {
        const inputField = document.getElementById('chat-input');
        const userInput = inputField.value.trim();
        if (!userInput) return;

        appendMessage('user', userInput);
        inputField.value = '';

        appendMessage('assistant', 'Typing...');
        const responseText = await getChatbotResponse(userInput);

        const chatContainer = document.getElementById('chat-container');
        if (chatContainer.lastElementChild && chatContainer.lastElementChild.innerText.includes('Typing...')) {
          chatContainer.lastElementChild.remove();
        }
        appendMessage('assistant', responseText);
      });

      document.getElementById('chat-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendButton.click();
        }
      });
    });
  </script>
</body>
</html>
